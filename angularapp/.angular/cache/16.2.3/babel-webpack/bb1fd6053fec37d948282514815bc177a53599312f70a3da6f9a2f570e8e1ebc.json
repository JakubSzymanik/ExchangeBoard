{"ast":null,"code":"var _class;\nimport { take } from 'rxjs';\nimport { MatDialogConfig } from '@angular/material/dialog';\nimport { MatchDialogComponent } from '../../matches/match-dialog/match-dialog.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../_services/matches.service\";\nimport * as i2 from \"../../_services/account.service\";\nimport * as i3 from \"../../_services/current-item-share.service\";\nimport * as i4 from \"@angular/material/dialog\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../owned-item-card/owned-item-card.component\";\nimport * as i7 from \"../matchable-item-card/matchable-item-card.component\";\nfunction ItemPageComponent_div_0_app_matchable_item_card_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-matchable-item-card\", 3);\n    i0.ɵɵlistener(\"likeClickedEvent\", function ItemPageComponent_div_0_app_matchable_item_card_2_Template_app_matchable_item_card_likeClickedEvent_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r3.sendLike());\n    })(\"dislikeClickedEvent\", function ItemPageComponent_div_0_app_matchable_item_card_2_Template_app_matchable_item_card_dislikeClickedEvent_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r5.sendDislike());\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"item\", ctx_r2.matchableItem);\n  }\n}\nfunction ItemPageComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"app-owned-item-card\", 1);\n    i0.ɵɵtemplate(2, ItemPageComponent_div_0_app_matchable_item_card_2_Template, 1, 1, \"app-matchable-item-card\", 2);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r1 = ctx.ngIf;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"item\", item_r1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.matchableItem != null);\n  }\n}\nexport class ItemPageComponent {\n  constructor(matchesService, accountService, currentItemShareService, dialog) {\n    this.matchesService = matchesService;\n    this.accountService = accountService;\n    this.currentItemShareService = currentItemShareService;\n    this.dialog = dialog;\n    this.matchableItem = null;\n    this.userItem = null;\n    this.userId = 0;\n    this.itemId = 0;\n  }\n  openMatchDialog(itemA, itemB) {\n    const dialogConfig = new MatDialogConfig();\n    dialogConfig.data = {\n      itemA: itemA,\n      itemB: itemB\n    };\n    return this.dialog.open(MatchDialogComponent, dialogConfig);\n  }\n  ngOnInit() {\n    this.accountService.currentUser$.pipe(take(1)).subscribe({\n      next: user => this.userId = user?.id\n    });\n    this.currentItemShareService.getItem.subscribe(item => {\n      this.userItem = item;\n      this.itemId = item?.id;\n    });\n    this.getNextMatchable();\n  }\n  getNextMatchable() {\n    this.matchesService.getNextMatchableItem(this.userId, this.itemId).subscribe(item => this.matchableItem = item);\n  }\n  sendLike() {\n    this.matchesService.sendLike(this.itemId, this.matchableItem.id).subscribe(v => {\n      if (v) {\n        if (!this.userItem || !this.matchableItem) {\n          /*Handle error*/\n          return;\n        }\n        const dialogRef = this.openMatchDialog(this.userItem, this.matchableItem);\n        dialogRef.afterClosed().subscribe(data => {\n          if (data) {/*Redirect to matches*/} else {/*keep browsing, probably dont have to do anything*/}\n        });\n      }\n      this.getNextMatchable();\n    });\n  }\n  sendDislike() {\n    this.matchesService.sendDislike(this.itemId, this.matchableItem.id).subscribe(v => this.getNextMatchable());\n  }\n}\n_class = ItemPageComponent;\n_class.ɵfac = function ItemPageComponent_Factory(t) {\n  return new (t || _class)(i0.ɵɵdirectiveInject(i1.MatchesService), i0.ɵɵdirectiveInject(i2.AccountService), i0.ɵɵdirectiveInject(i3.CurrentItemShareService), i0.ɵɵdirectiveInject(i4.MatDialog));\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"app-item-page\"]],\n  decls: 2,\n  vars: 3,\n  consts: [[4, \"ngIf\"], [3, \"item\"], [3, \"item\", \"likeClickedEvent\", \"dislikeClickedEvent\", 4, \"ngIf\"], [3, \"item\", \"likeClickedEvent\", \"dislikeClickedEvent\"]],\n  template: function ItemPageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, ItemPageComponent_div_0_Template, 3, 2, \"div\", 0);\n      i0.ɵɵpipe(1, \"async\");\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 1, ctx.currentItemShareService.getItem));\n    }\n  },\n  dependencies: [i5.NgIf, i6.OwnedItemCardComponent, i7.MatchableItemCardComponent, i5.AsyncPipe],\n  styles: [\"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"names":["take","MatDialogConfig","MatchDialogComponent","i0","ɵɵelementStart","ɵɵlistener","ItemPageComponent_div_0_app_matchable_item_card_2_Template_app_matchable_item_card_likeClickedEvent_0_listener","ɵɵrestoreView","_r4","ctx_r3","ɵɵnextContext","ɵɵresetView","sendLike","ItemPageComponent_div_0_app_matchable_item_card_2_Template_app_matchable_item_card_dislikeClickedEvent_0_listener","ctx_r5","sendDislike","ɵɵelementEnd","ɵɵproperty","ctx_r2","matchableItem","ɵɵelement","ɵɵtemplate","ItemPageComponent_div_0_app_matchable_item_card_2_Template","ɵɵadvance","item_r1","ctx_r0","ItemPageComponent","constructor","matchesService","accountService","currentItemShareService","dialog","userItem","userId","itemId","openMatchDialog","itemA","itemB","dialogConfig","data","open","ngOnInit","currentUser$","pipe","subscribe","next","user","id","getItem","item","getNextMatchable","getNextMatchableItem","v","dialogRef","afterClosed","ɵɵdirectiveInject","i1","MatchesService","i2","AccountService","i3","CurrentItemShareService","i4","MatDialog","selectors","decls","vars","consts","template","ItemPageComponent_Template","rf","ctx","ItemPageComponent_div_0_Template","ɵɵpipeBind1"],"sources":["D:\\ProgrammingProjects\\ExchangeBoard\\angularapp\\src\\app\\items\\item-page\\item-page.component.ts","D:\\ProgrammingProjects\\ExchangeBoard\\angularapp\\src\\app\\items\\item-page\\item-page.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { Item } from '../../_models/item';\r\nimport { ItemsService } from '../../_services/items.service';\r\nimport { CurrentItemShareService } from '../../_services/current-item-share.service';\r\nimport { AccountService } from '../../_services/account.service';\r\nimport { UserToken } from '../../_models/user-token';\r\nimport { concatMap, take } from 'rxjs';\r\nimport { MatchesService } from '../../_services/matches.service';\r\nimport { MatDialog, MatDialogConfig } from '@angular/material/dialog';\r\nimport { MatchDialogComponent } from '../../matches/match-dialog/match-dialog.component';\r\n\r\n@Component({\r\n  selector: 'app-item-page',\r\n  templateUrl: './item-page.component.html',\r\n  styleUrls: ['./item-page.component.css']\r\n})\r\nexport class ItemPageComponent {\r\n\r\n  matchableItem: Item | null = null;\r\n  userItem: Item | null = null;\r\n  userId: number = 0;\r\n  itemId: number = 0;\r\n\r\n  constructor(private matchesService: MatchesService,\r\n    private accountService: AccountService,\r\n    protected currentItemShareService: CurrentItemShareService,\r\n    private dialog: MatDialog) { }\r\n    \r\n\r\n  openMatchDialog(itemA: Item, itemB: Item) {\r\n    const dialogConfig = new MatDialogConfig();\r\n    dialogConfig.data = {\r\n      itemA: itemA,\r\n      itemB: itemB\r\n    }\r\n\r\n    return this.dialog.open(MatchDialogComponent, dialogConfig);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.accountService.currentUser$.pipe(take(1)).subscribe({\r\n      next: user => this.userId = user?.id as number\r\n    });\r\n    this.currentItemShareService.getItem.subscribe(item => {\r\n      this.userItem = item;\r\n      this.itemId = item?.id as number\r\n    })\r\n\r\n    this.getNextMatchable();\r\n  }\r\n\r\n  getNextMatchable() {\r\n    this.matchesService.getNextMatchableItem(this.userId, this.itemId).subscribe(item => this.matchableItem = item);\r\n  }\r\n\r\n  sendLike() {\r\n    this.matchesService.sendLike(this.itemId, this.matchableItem!.id)\r\n      .subscribe(v => {\r\n        if (v) {\r\n          if (!this.userItem || !this.matchableItem) {/*Handle error*/ return; }\r\n          const dialogRef = this.openMatchDialog(this.userItem, this.matchableItem);\r\n          dialogRef.afterClosed().subscribe(data => {\r\n            if (data as boolean) {/*Redirect to matches*/ }\r\n            else {/*keep browsing, probably dont have to do anything*/ }     \r\n          })\r\n        }\r\n        this.getNextMatchable()\r\n      });\r\n  }\r\n\r\n  sendDislike() {\r\n    this.matchesService.sendDislike(this.itemId, this.matchableItem!.id)\r\n      .subscribe(v => this.getNextMatchable());\r\n  }\r\n}\r\n","<div *ngIf=\"(currentItemShareService.getItem | async) as item\">\n  <app-owned-item-card [item]=\"item\"></app-owned-item-card>\n  <app-matchable-item-card *ngIf=\"matchableItem != null\" [item]=\"matchableItem\" (likeClickedEvent)=\"sendLike()\" (dislikeClickedEvent)=\"sendDislike()\"></app-matchable-item-card>\n</div>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}